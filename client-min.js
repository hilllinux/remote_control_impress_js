var socket="";var manager="";var url="http://wangsongqing.gitcafe.io/";function log(a){console.log(a)}var socket_config={server:"http://appoint.yimood.com:3000",paltform:"web"};var reg_info={key:11111,m_key:22222};function ctl_cmd(a){}function init_socket(){manager=io.Manager(socket_config.server,{reconnection:true,timeout:1000,reconnectionAttempts:5000,reconnectionDelay:10});socket=manager.socket("/");socket.on("reg",function(b){try{var c=JSON.parse(b);log(b);switch(c.msg){case"unreg":unreg();break;case"connected":log("connected");break;default:log(b);break}}catch(a){log(a+"APP注册请求的JSON格式不正确");return}});socket.on("disconnect",function(){log("服务器断开连接")});socket.on("connect_error",function(){log(" 连接错误!")});socket.on("reconnect_attempt",function(){log(" 开始重连")});socket.on("reconnect_failed",function(){socket.close();manager.close();log(" 重连失败")});socket.on("control",function(a){ctl_cmd(a)})}function unreg(){socket.emit("reg",JSON.stringify(reg_info))}function send_cmd(a){try{socket.emit("control",JSON.stringify(a))}catch(b){log(b)}}function control_init(){var a=GetUrlParms();var c=Object.size(a);try{var b=a.key;var f=a.m_key;reg_info={key:b,m_key:f};init_socket()}catch(d){console.log(d)}}function control_prev(){var a={cmd:"prev",data:"1"};send_cmd(a)}function control_next(){var a={cmd:"next",data:"1"};send_cmd(a)}function control_goto(b){var a={cmd:"next",data:b.value};send_cmd(a)}function GetUrlParms(){var b=new Object();var f=location.search.substring(1);var e=f.split("&");for(var c=0;c<e.length;c++){var g=e[c].indexOf("=");if(g==-1){continue}var a=e[c].substring(0,g);var d=e[c].substring(g+1);b[a]=unescape(d)}return b}function randomString(c){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");if(!c){c=Math.floor(Math.random()*b.length)}var d="";for(var a=0;a<c;a++){d+=b[Math.floor(Math.random()*b.length)]}return d}function generate_keys(){return{key:randomString(6),m_key:randomString(6)}}Object.size=function(c){var b=0,a;for(a in c){if(c.hasOwnProperty(a)){b++}}return b};function screen_init(){reg_info=generate_keys();init_socket();var a=url+"?key="+reg_info.m_key+"&m_key="+reg_info.key;return a};